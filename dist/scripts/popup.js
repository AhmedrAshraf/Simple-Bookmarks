$(function(){"use strict";function a(a,d){d||!a.isOpen?b(a):c(a)}function b(a){a.isOpen=!0,a.el.addClass("open"),a.sublistEl&&a.sublistEl.slideDown()}function c(a){a.isOpen=!1,a.el.removeClass("open"),a.sublistEl&&a.sublistEl.slideUp()}function d(a){var b,c=$('<li class="bm-item"></li>'),d=$('<a class="bm-item-title">'+a.title+"</a>"),e=$('<i class="bm-item-favicon"></i>');return c.append(d.prepend(e)),c.attr({id:"bmitem-"+a.id,"data-id":a.id,"data-index":a.index}),c.addClass(a.children?"bm-item-directory":"bm-item-bookmark"),d.attr({href:a.url||"javascript:"}),a.url&&e.append('<img src="chrome://favicon/'+a.url+'">'),b={id:a.id,el:c,data:a},i[a.id]=b,b}function e(a){var b=$('<ul class="bm-sublist"></ul>');return a.el.append(b),a.sublistEl=b,a.isOpen!==!0&&b.css("display","none"),b}function f(a,b){function c(){j?(j.sublistEl||e(j),j.sublistEl.append(a.el)):h.append(a.el)}var g=a.data.parentId,j=i[g];!j&&b?chrome.bookmarks.get(g+"",function(e){var g=e&&e[0];g&&simpleBookmarks.isCorrectNode(g)&&(j=d(g),f(a,b)),c()}):c()}var g=$(document),h=$("#bookmarks"),i={};simpleBookmarks.traversalBookmarks(function(a){var b=d(a);f(b,!0)}),g.on("click",".bm-item-title",function(b){var c,d=$(this).closest(".bm-item"),e=i[d.attr("data-id")],f=b.ctrlKey||b.metaKey,g=b.shiftKey;return d.hasClass("bm-item-directory")?a(e):d.hasClass("bm-item-bookmark")&&(c=e.data.url,f?simpleBookmarks.openBookmarksNewTab(c,!0):g?simpleBookmarks.openBookmarksNewWindow(c):simpleBookmarks.openBookmarkCurrentTab(c,!0)),!1})});