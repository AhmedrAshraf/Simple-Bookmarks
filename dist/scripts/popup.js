!function(a,b){"use strict";function c(b){var c=[];b=a.trim(b).toLowerCase(),b?(s.children().detach(),a.each(u.allBookmarkItems,function(a,d){var e=d.data.title.toLowerCase(),f=d.data.url.toLowerCase();(-1!==e.indexOf(b)||-1!==f.indexOf(b))&&c.push(d)})):c=u.allItems,a.each(c,function(a,b){l(b)})}function d(a,b){b||!a.isOpen?e(a):f(a)}function e(a){a.isOpen=!0,a.el.addClass("open"),a.sublistEl&&a.sublistEl.slideDown(),b.storage(a.id+"-"+p,!0)}function f(a){a.isOpen=!1,a.el.removeClass("open"),a.sublistEl&&a.sublistEl.slideUp(),b.storage(a.id+"-"+p,void 0)}function g(a){var c={id:a.id,data:a,isOpen:b.storage(a.id+"-"+p)};return a.title?(a.children?(c.el=h(a),c.type=m):"-----"===a.title.replace(q,"").substring(0,5)?(c.el=j(a),c.type=o):a.url&&(c.el=i(a),c.type=n,u.allBookmarkItems.push(c)),u[a.id]=c,u.allItems.push(c),c):null}function h(b){return a('<li id="bmitem-'+b.id+'" class="bm-item bm-item-directory" data-id="'+b.id+'" data-index="'+b.index+'"><span class="bm-item-title"><i class="bm-item-favicon"></i>'+b.title+"</span></li>")}function i(b){return a('<li id="bmitem-'+b.id+'" class="bm-item bm-item-bookmark" data-id="'+b.id+'" data-index="'+b.index+'"><a class="bm-item-title" href="'+b.url+'"><i class="bm-item-favicon"><img src="chrome://favicon/'+b.url+'" /></i>'+b.title+"</a></li>")}function j(b){var c=b.title.replace(r,"");return a('<li id="bmitem-'+b.id+'" class="bm-item bm-item-separator" data-id="'+b.id+'" data-index="'+b.index+'"><span class="bm-item-title"><span class="line"></span><span class="text">'+c+"</span></span></li>")}function k(b){var c=a('<ul class="bm-sublist"></ul>');return b.el.append(c),b.sublistEl=c,b.isOpen!==!0&&c.css("display","none"),c}function l(c,d){function e(){j&&a.contains(document.body,j.el[0])?h(j,c):f(c)}function f(a){s.append(a.el)}function h(a,b){a.sublistEl||k(a),a.sublistEl.append(b.el)}if(c){var i=c.data.parentId,j=u[i];d?j?a.contains(document.body,j.el[0])?e():(l(j,d),h(j,c)):chrome.bookmarks.get(i+"",function(a){var f=a&&a[0];f&&b.isCorrectNode(f)&&(j=g(f),l(j,d)),e(c)}):e()}}var m=1,n=2,o=3,p="1",q=/\s/g,r=/[\s-]/g,s=a("#bookmarks"),t=a("#search"),u={allItems:[],allBookmarkItems:[]};b.init(function(){b.traversalBookmarks(function(a){var b=g(a);l(b,!0)}),s.on("click",".bm-item-title",function(c){var e,f=a(this).closest(".bm-item"),g=u[f.attr("data-id")],h=c.ctrlKey||c.metaKey,i=c.shiftKey;return f.hasClass("bm-item-directory")?d(g):f.hasClass("bm-item-bookmark")&&(e=g.data.url,h?b.openBookmarksNewTab(e,!0):i?b.openBookmarksNewWindow(e):b.openBookmarkCurrentTab(e,!0)),!1}),t.on("keyup",function(){var b=a(this);c(b.val())})})}(jQuery,simpleBookmarks);